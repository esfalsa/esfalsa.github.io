<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />

		<link rel="apple-touch-icon" sizes="180x180" href="../../../../apple-touch-icon.png" />
		<link rel="icon" href="../../../../favicon.svg" />
		<link rel="icon" type="image/png" sizes="32x32" href="../../../../favicon-32x32.png" />
		<link rel="icon" type="image/png" sizes="16x16" href="../../../../favicon-16x16.png" />
		<link rel="manifest" href="../../../../site.webmanifest" />
		<link rel="mask-icon" href="../../../../safari-pinned-tab.svg" color="#5bbad5" />
		<meta name="msapplication-TileColor" content="#da532c" />
		<meta name="theme-color" content="#ffffff" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta http-equiv="content-security-policy" content="">
	<link rel="stylesheet" href="/_app/immutable/assets/__layout-2360878f.css">
	<link rel="modulepreload" href="/_app/immutable/start-ec0fcd65.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/index-042c205f.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/index-89fac7e4.js">
	<link rel="modulepreload" href="/_app/immutable/pages/__layout.svelte-7f3e3a04.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/link-4f7a5115.js">
	<link rel="modulepreload" href="/_app/immutable/pages/blog/2023/01/07/region-archiver-streams.md-cd4a639a.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/_post-53d9098c.js">
	</head>
	<body>
		


<div class="fixed top-0 z-50 w-full p-4">

  <nav class="bg-slate-800/80 backdrop-blur-2xl rounded-xl z-50 flex flex-row flex-wrap items-center content-center w-full p-4 text-white transition-all shadow-xl"><div><a sveltekit:prefetch href="/" target="" class="mr-12 text-xl font-bold text-center">Pronoun</a></div>
		<div class="lg:flex flex-row items-center hidden space-x-6 text-xs font-semibold tracking-wide text-center uppercase"><a sveltekit:prefetch href="/about" target="" class="hover:text-slate-50 h-fit transition text-slate-300/75">About Me
				</a><a sveltekit:prefetch href="/blog" target="" class="hover:text-slate-50 h-fit transition text-slate-50">Blog
				</a><a sveltekit:prefetch href="/projects#applesauce" target="" class="hover:text-slate-50 h-fit transition text-slate-300/75">Applesauce
				</a><a sveltekit:prefetch href="/projects#puree" target="" class="hover:text-slate-50 h-fit transition text-slate-300/75">Purée
				</a><a sveltekit:prefetch href="/projects#spsf-data-portal" target="" class="hover:text-slate-50 h-fit transition text-slate-300/75">SPSF Data Portal
				</a><a sveltekit:prefetch href="/projects#streamkit" target="" class="hover:text-slate-50 h-fit transition text-slate-300/75">StreamKit
				</a><a sveltekit:prefetch href="/projects#spyglass-archive" target="" class="hover:text-slate-50 h-fit transition text-slate-300/75">Spyglass Archive
				</a><a sveltekit:prefetch href="/contact" target="" class="hover:text-slate-50 h-fit transition text-slate-300/75">Contact
				</a></div>
		
  <button id="headlessui-menu-button-23" type="button" aria-haspopup aria-expanded="false" class="lg:hidden block ml-auto"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path></svg></button>
		<div class="basis-full h-0 transition-all"></div>
		</nav></div>

<main class="mx-8 mt-28 mb-16"><div class="max-w-5xl mx-auto space-y-8 pt-8"><a sveltekit:prefetch href="/blog" target="" class="link ">← All blog posts</a>
	<article class="prose prose-slate pt-8"><h1>Region Archiver DevBlog: If Only It Were That Simple</h1>
		<p class="lead">January 8, 2023 at 5:06 PM</p>

		<p>It’s a little weird to think that the last time I posted, I was talking about how my code was actually working. Unfortunately, I spoke a little too soon; once I linked it up with actually pulling flags from NationStates, it definitely was not working. This DevBlog won’t be so much about reporting progress as reporting future plans, because progress since then has been difficult amid debugging and real-life scheduling.</p>
<p>One of the biggest flaws in the parsing logic I originally wrote was that it was events-driven. It could get through the daily dump itself in a matter of seconds, but would then have thousands of rate-limited flag and banner requests queued up, at least on the first run. I wasn’t getting any errors, but things weren’t happening in the order I was expecting and it seemed like some requests were being silently dropped. Although I tried to debug those issues for a bit, eventually I just gave up and decided to start working on a streaming parser implemention instead.</p>
<p>So that’s where I’m at now. The gist of it is that I get a stream for the daily dump download, pipe it through an unzip stream, then a parser stream that converts it into chunks of data to save, and finally to a stream writing it into files for eah region. Although I haven’t copied over the parsing logic yet, I do know my stream pipeline is working at least. I’m actually not entirely sure why it’s working, since it’s apparently able to pause and resume the download stream based on backpressure, but if that ever fails I can hopefully just save the daily dump locally and create a read stream from the file.</p>
<p>I do still need to actually get my code working, of course. I’m pretty sure I know how to write everything I have left to write, but then again, that’s what I was thinking a week and a half ago and it turns out I wasn’t quite correct, so we’ll have to see. It would be nice to have something working before my winter break ends in a week or so, and that’s not even counting the browser extension I’m planning to actually use all this data.</p></article></div></main>


		<script type="module" data-sveltekit-hydrate="12vml5o">
		import { set_public_env, start } from "/_app/immutable/start-ec0fcd65.js";

		set_public_env({});

		start({
			target: document.querySelector('[data-sveltekit-hydrate="12vml5o"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [0, 9],
				params: {},
				routeId: "blog/2023/01/07/region-archiver-streams"
			}
		});
	</script>
	</body>
</html>
